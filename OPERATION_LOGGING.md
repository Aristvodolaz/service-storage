# –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π API

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π API —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –ö–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –∫ API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `x_API_Operation_Logs`.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ª–æ–≥–æ–≤:

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç create_operation_logs_table.sql –≤ –≤–∞—à–µ–π –ë–î MS SQL Server
```

SQL-—Å–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞: `create_operation_logs_table.sql`

### 2. –¢–∞–±–ª–∏—Ü–∞ x_API_Operation_Logs

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | BIGINT | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| `endpoint` | NVARCHAR(500) | URL endpoint –∑–∞–ø—Ä–æ—Å–∞ |
| `http_method` | NVARCHAR(10) | HTTP –º–µ—Ç–æ–¥ (GET, POST, PUT, DELETE) |
| `query_params` | NVARCHAR(MAX) | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã query string (JSON) |
| `body_params` | NVARCHAR(MAX) | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON) |
| `route_params` | NVARCHAR(MAX) | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∞ (JSON) |
| `ip_address` | NVARCHAR(45) | IP –∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞ |
| `user_agent` | NVARCHAR(500) | User Agent –∫–ª–∏–µ–Ω—Ç–∞ |
| `status_code` | INT | HTTP –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ |
| `execution_time_ms` | INT | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–º—Å) |
| `executor` | NVARCHAR(100) | ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `operation_result` | NVARCHAR(20) | –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ (success/error) |
| `error_message` | NVARCHAR(MAX) | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) |
| `created_at` | DATETIME2 | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:

- ‚úÖ –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã (GET, POST, PUT, DELETE, PATCH)
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (query, body, params)
- ‚úÖ IP –∞–¥—Ä–µ—Å –∏ User Agent –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –ß—Ç–æ –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è):

- üîí –ü–∞—Ä–æ–ª–∏
- üîí –¢–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏ API
- üîí –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
- üîí Authorization –∑–∞–≥–æ–ª–æ–≤–∫–∏

–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `***FILTERED***`

## –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):

1. `req.body.executor` - –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
2. `req.query.executor` - –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ query
3. `req.headers['x-executor-id']` - –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```javascript
// –í POST –∑–∞–ø—Ä–æ—Å–µ
{
  "productId": "12345",
  "executor": "user_123"
}

// –í GET –∑–∞–ø—Ä–æ—Å–µ
GET /api/storage/info?article=12345&executor=user_123

// –í –∑–∞–≥–æ–ª–æ–≤–∫–µ
headers: {
  'X-Executor-Id': 'user_123'
}
```

## API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

### GET /api/logs

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ª–æ–≥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `endpoint` | string | –§–∏–ª—å—Ç—Ä –ø–æ endpoint (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ) |
| `http_method` | string | HTTP –º–µ—Ç–æ–¥ (GET, POST, PUT, DELETE, PATCH) |
| `executor` | string | ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |
| `status_code` | integer | HTTP –∫–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ |
| `operation_result` | string | –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ (success, error) |
| `date_from` | datetime | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (ISO 8601) |
| `date_to` | datetime | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (ISO 8601) |
| `limit` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100, –º–∞–∫—Å 1000) |
| `offset` | integer | –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0) |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

```bash
# –í—Å–µ –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
GET /api/logs?date_from=2026-02-02T00:00:00Z&date_to=2026-02-03T00:00:00Z

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
GET /api/logs?operation_result=error

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/logs?executor=user_123

# –õ–æ–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ endpoint
GET /api/logs?endpoint=/api/storage/move

# –° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
GET /api/logs?limit=50&offset=100
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "endpoint": "/api/storage/move/12345",
      "http_method": "POST",
      "query_params": null,
      "body_params": "{\"locationId\":\"67890\",\"executor\":\"user_123\"}",
      "route_params": "{\"productId\":\"12345\"}",
      "ip_address": "192.168.1.100",
      "user_agent": "Mozilla/5.0...",
      "status_code": 200,
      "execution_time_ms": 145,
      "executor": "user_123",
      "operation_result": "success",
      "error_message": null,
      "created_at": "2026-02-03T10:30:00.000Z"
    }
  ],
  "meta": {
    "total": 1250,
    "limit": 100,
    "offset": 0
  }
}
```

### GET /api/logs/statistics

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ª–æ–≥–∞–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `date_from` | datetime | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (ISO 8601) |
| `date_to` | datetime | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (ISO 8601) |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**

```bash
GET /api/logs/statistics?date_from=2026-02-01T00:00:00Z&date_to=2026-02-03T23:59:59Z
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "success": true,
  "data": {
    "total": 15420,
    "successful": 14850,
    "errors": 570,
    "successRate": "96.30"
  }
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å** - –ª–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –ª–æ–≥–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
3. **–ò–Ω–¥–µ–∫—Å—ã –ë–î** - —Å–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –ø–æ–ª—è–º
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### –ò–Ω–¥–µ–∫—Å—ã:

- `idx_created_at` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ
- `idx_endpoint` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ endpoint
- `idx_executor` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
- `idx_status_code` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
HTTP Request
    ‚Üì
operationLogger (middleware) - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
    ‚Üì
Routes ‚Üí Controllers ‚Üí Services ‚Üí Repositories
    ‚Üì
operationLogger - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç
    ‚Üì
OperationLogService - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    ‚Üì
OperationLogRepository - –∑–∞–ø–∏—Å—å –≤ –ë–î
    ‚Üì
x_API_Operation_Logs (—Ç–∞–±–ª–∏—Ü–∞)
```

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –ú–æ–¥–µ–ª–∏
- `src/models/OperationLog.js` - –º–æ–¥–µ–ª—å –ª–æ–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- `src/repositories/OperationLogRepository.js` - —Ä–∞–±–æ—Ç–∞ —Å –ë–î –¥–ª—è –ª–æ–≥–æ–≤

### –°–µ—Ä–≤–∏—Å—ã
- `src/services/OperationLogService.js` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### Middleware
- `src/middlewares/operationLogger.js` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- `src/controllers/OperationLogController.js` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –ª–æ–≥–æ–≤

### –ú–∞—Ä—à—Ä—É—Ç—ã
- `src/routes/operationLog.js` - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏

## Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Swagger:

```
http://localhost:3006/api-docs
```

–ò—â–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"–õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π"**

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

–î–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ —Å–æ–∑–¥–∞–π—Ç–µ SQL –∑–∞–¥–∞—á—É (Job) –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:

```sql
-- –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
DELETE FROM x_API_Operation_Logs
WHERE created_at < DATEADD(day, -90, GETDATE());
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) as total_logs FROM x_API_Operation_Logs;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
EXEC sp_spaceused 'x_API_Operation_Logs';
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∑–∞ –¥–µ–Ω—å

```bash
GET /api/logs?operation_result=error&date_from=2026-02-03T00:00:00Z&date_to=2026-02-03T23:59:59Z
```

### –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
GET /api/logs?executor=user_123&date_from=2026-02-01T00:00:00Z
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è > 1 —Å–µ–∫—É–Ω–¥—ã
SELECT * FROM x_API_Operation_Logs
WHERE execution_time_ms > 1000
ORDER BY execution_time_ms DESC;
```

### –û—Ç—á–µ—Ç –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º endpoint

```sql
SELECT 
  endpoint,
  COUNT(*) as request_count,
  AVG(execution_time_ms) as avg_time_ms
FROM x_API_Operation_Logs
WHERE created_at >= DATEADD(day, -7, GETDATE())
GROUP BY endpoint
ORDER BY request_count DESC;
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è `/api/logs/*`
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** - –±–æ–ª—å—à–∏–µ JSON –æ–±—ä–µ–∫—Ç—ã –æ–±—Ä–µ–∑–∞—é—Ç—Å—è

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –õ–æ–≥–∏ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ–∑–¥–∞–Ω–∞ –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `x_API_Operation_Logs`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ middleware –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `app.js`

### –û—à–∏–±–∫–∞ "—Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç `create_operation_logs_table.sql`

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ API

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î
2. –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–µ –ª–æ–≥–æ–≤

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
